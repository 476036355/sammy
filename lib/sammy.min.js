(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super;this._super=f[h];var j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}function c(){if(!a&&this.init){this.init.apply(this,arguments)}}c.prototype=e;c.constructor=c;c.extend=arguments.callee;return c}})();(function(c){var a="([^/]+)";var b=/:([\w\d]+)/g;Sammy={};Sammy.Object=Class.extend({init:function(d){c.extend(this,d)},clone:function(d){return c.extend({},d)},toHTML:function(){var d="";c.each(this,function(f,e){if(e.constructor!=Function){d+="<strong>"+f+"</strong> "+e+"<br />"}});return d},uuid:function(){if(typeof this._uuid=="undefined"||!this._uuid){this._uuid=Date.now()+"-"+parseInt(Math.random()*1000)}return this._uuid},log:function(){if(typeof window.console!="undefined"){window.console.log.apply(window.console,arguments)}else{if(typeof console!="undefined"){console.log.apply(this,arguments)}else{}}}});Sammy.Application=Sammy.Object.extend({route_verbs:["get","post","put"],data_store_name:"sammy.app",last_route:null,silence_404:true,run_interval_every:50,element_selector:"body",init:function(d){var e=this;this.routes={};this.namespace=this.uuid();c.each(this.route_verbs,function(){e._defineRouteShortcut(this)});d.apply(this);this.trigger("init")},$element:function(){return c(this.element_selector)},route:function(g,e,i){var f=this;var h=[];if(e.constructor==String){while((path_match=b.exec(e))!=null){h.push(path_match[1])}e=new RegExp(e.replace(b,a))}var d={verb:g,path:e,callback:i,param_names:h};if(typeof this.routes[g]=="undefined"){this.routes[g]=[d]}else{c.each(this.routes[g],function(k,j){if(e.toString().length>=j.path.toString().length){f.routes[g].splice(k,0,d);return false}})}return d},eventNamespace:function(){return this.data_store_name+":"+this.namespace},bind:function(d,e,f){if(typeof f=="undefined"){f=e}return this.$element().bind(this.eventNamespace()+":"+d,e,function(){return f.apply(arguments[1],[arguments[0],arguments[2]])})},trigger:function(d,f,e){if(typeof e=="undefined"){e=this}return this.$element().triggerHandler(this.eventNamespace()+":"+d,[e,f])},run:function(d){var e=this;this.trigger("run",{start_url:d});this.$element().data(this.data_store_name,this);this.last_location={href:"",pathname:"",hash:""};if(typeof d!="undefined"){window.location=d}this._checkURL();this._interval=setInterval(function(){e._checkURL.apply(e)},this.run_interval_every);this.bind("html-changed",function(){e.$element().find("form").bind("submit",function(){return e._checkFormSubmission(this)})});c("body").bind("onunload",function(){e.unload()});this.trigger("html-changed")},unload:function(){this.trigger("unload");clearInterval(this._interval);this.$element().find("form").unbind("submit");this.$element().removeData(this.data_store_name)},lookupRoute:function(f,e){var d=false;this.trigger("lookup-route",{verb:f,path:e});if(typeof this.routes[f]!="undefined"){c.each(this.routes[f],function(h,g){if(e.match(g.path)){d=g;return false}})}return d},runRoute:function(i,g,h){this.trigger("run-route",{verb:i,path:g,params:h});if(typeof h=="undefined"){h={}}var d=this.lookupRoute(i,g);if(d){this.trigger("route-found",{route:d});if((path_params=d.path.exec(g))!=null){path_params.shift();c.each(path_params,function(j,k){if(d.param_names[j]){h[d.param_names[j]]=k}else{if(!h.splat){h.splat=[]}h.splat.push(k)}})}var e=new Sammy.EventContext(this,i,g,h);this.last_route=d;e.trigger("event-context-before");var f=d.callback.apply(e);e.trigger("event-context-after");return f}else{this.notFound(i,g)}},currentLocation:function(){var d=this.clone(window.location);return d},notFound:function(e,d){this.trigger("error-404",{verb:e,path:d});if(!this.silence_404){throw ("404 Not Found "+e+" "+d)}},_defineRouteShortcut:function(e){var d=this;this[e]=function(f,g){d.route.apply(d,[e,f,g])}},_checkURL:function(){var d=this.currentLocation();if(d.hash!=""&&d.hash!=this.last_location.hash){this.runRoute("get",d.hash)}else{if(d.pathname!=this.last_location.pathname){this.runRoute("get",d.pathname)}}this.last_location=d},_checkFormSubmission:function(e){var d,f,h,g;this.trigger("check-form-submission",{form:e});d=c(e);f=d.attr("action");h=d.attr("method").toString().toLowerCase();g={};d.find(":input[type!=submit]").each(function(){g[c(this).attr("name")]=c(this).val()});this.runRoute(h,f,g);return false}});Sammy.EventContext=Sammy.Object.extend({render_types:{text:"renderText",html:"renderHTML",partial:"renderPartial"},init:function(g,f,d,e){this.app=g;this.verb=f;this.path=d;this.params=new Sammy.Object(e)},render:function(e,d,f){return this[this.render_types[e]](d,f)},renderText:function(d,e){var f=c(d).text(e);this.trigger("render-text",{selector:d,content:e});this.trigger("html-changed");return f},renderHTML:function(d,e){var f=c(d).html(e);this.trigger("render-html",{selector:d,content:e});this.trigger("html-changed");return f},renderPartial:function(d,f){var e=this;this.trigger("render-partial",{selector:d,content:f});return c.get(f,function(g){c(d).html(g);e.trigger("html-changed")})},redirect:function(d){this.trigger("redirect",{to:d});if(d.match(/^\#/)){window.location.hash=d}else{if(d.match(/^\//)){window.location.pathname=d}else{window.location=d}}return true},trigger:function(d,e){return this.app.trigger(d,e,this)},notFound:function(){return this.app.notFound(this.verb,this.path)}})})(jQuery);